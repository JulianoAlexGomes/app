# Generated by Django 6.0.1 on 2026-02-26 20:45

import django.db.models.deletion
import django.utils.timezone
import uuid
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('core', '0023_icmsorigindestination'),
    ]

    operations = [
        migrations.CreateModel(
            name='Invoice',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('uid', models.UUIDField(default=uuid.uuid4, editable=False, unique=True)),
                ('model', models.CharField(choices=[('55', 'NF-e (55)'), ('65', 'NFC-e (65)')], max_length=2, verbose_name='Modelo')),
                ('serie', models.CharField(max_length=3, verbose_name='Série')),
                ('number', models.PositiveIntegerField(verbose_name='Número')),
                ('code_nf', models.CharField(blank=True, max_length=8, verbose_name='cNF (8 dígitos)')),
                ('access_key', models.CharField(blank=True, db_index=True, max_length=44, verbose_name='Chave de Acesso')),
                ('dv', models.PositiveSmallIntegerField(blank=True, null=True, verbose_name='Dígito Verificador')),
                ('environment', models.CharField(choices=[('1', 'Produção'), ('2', 'Homologação')], max_length=1, verbose_name='Ambiente')),
                ('emission_type', models.CharField(choices=[('1', 'Emissão Normal'), ('9', 'Contingência Off-line')], default='1', max_length=1, verbose_name='Tipo de Emissão')),
                ('issue_date', models.DateTimeField(default=django.utils.timezone.now, verbose_name='Data de Emissão')),
                ('exit_date', models.DateTimeField(blank=True, null=True, verbose_name='Data de Saída/Entrada')),
                ('nature_operation', models.CharField(max_length=60, verbose_name='Natureza da Operação')),
                ('operation_type', models.CharField(choices=[('0', 'Entrada'), ('1', 'Saída')], default='1', max_length=1, verbose_name='Tipo Operação')),
                ('finality', models.CharField(choices=[('1', 'Normal'), ('2', 'Complementar'), ('3', 'Ajuste'), ('4', 'Devolução')], default='1', max_length=1, verbose_name='Finalidade')),
                ('presence_indicator', models.CharField(choices=[('0', 'Não se aplica'), ('1', 'Presencial'), ('2', 'Internet'), ('3', 'Teleatendimento'), ('9', 'Outros')], default='0', max_length=1, verbose_name='Indicador de Presença')),
                ('emit_name', models.CharField(max_length=255, verbose_name='Razão Social')),
                ('emit_fantasy', models.CharField(blank=True, max_length=255, verbose_name='Fantasia')),
                ('emit_cnpj', models.CharField(max_length=14, verbose_name='CNPJ')),
                ('emit_ie', models.CharField(blank=True, max_length=20, verbose_name='IE')),
                ('emit_im', models.CharField(blank=True, max_length=20, verbose_name='IM')),
                ('emit_tax_regime', models.CharField(choices=[('1', 'Simples Nacional'), ('2', 'Simples Nacional – Excesso'), ('3', 'Regime Normal')], max_length=1, verbose_name='Regime Tributário')),
                ('emit_street', models.CharField(max_length=255, verbose_name='Logradouro')),
                ('emit_number', models.CharField(max_length=20, verbose_name='Número')),
                ('emit_complement', models.CharField(blank=True, max_length=60, verbose_name='Complemento')),
                ('emit_district', models.CharField(max_length=60, verbose_name='Bairro')),
                ('emit_city', models.CharField(max_length=60, verbose_name='Cidade')),
                ('emit_city_code', models.CharField(max_length=7, verbose_name='IBGE Município')),
                ('emit_state', models.CharField(max_length=2, verbose_name='UF')),
                ('emit_zip_code', models.CharField(max_length=8, verbose_name='CEP')),
                ('emit_country_code', models.CharField(default='1058', max_length=4, verbose_name='Cód. País')),
                ('emit_phone', models.CharField(blank=True, max_length=14, verbose_name='Fone')),
                ('dest_name', models.CharField(max_length=255, verbose_name='Nome')),
                ('dest_cnpj', models.CharField(blank=True, max_length=14, verbose_name='CNPJ')),
                ('dest_cpf', models.CharField(blank=True, max_length=11, verbose_name='CPF')),
                ('dest_ie', models.CharField(blank=True, max_length=20, verbose_name='IE')),
                ('dest_taxpayer_type', models.CharField(choices=[('1', 'Contribuinte'), ('2', 'Isento'), ('9', 'Não Contribuinte')], default='9', max_length=1, verbose_name='Indicador IE')),
                ('dest_email', models.EmailField(blank=True, max_length=254, verbose_name='E-mail')),
                ('dest_phone', models.CharField(blank=True, max_length=14, verbose_name='Fone')),
                ('dest_street', models.CharField(blank=True, max_length=255, verbose_name='Logradouro')),
                ('dest_number', models.CharField(blank=True, max_length=20, verbose_name='Número')),
                ('dest_complement', models.CharField(blank=True, max_length=60, verbose_name='Complemento')),
                ('dest_neighborhood', models.CharField(blank=True, max_length=60, verbose_name='Bairro')),
                ('dest_city', models.CharField(blank=True, max_length=60, verbose_name='Cidade')),
                ('dest_city_code', models.CharField(blank=True, max_length=7, verbose_name='IBGE Município')),
                ('dest_state', models.CharField(blank=True, max_length=2, verbose_name='UF')),
                ('dest_zip_code', models.CharField(blank=True, max_length=8, verbose_name='CEP')),
                ('dest_country_code', models.CharField(default='1058', max_length=4, verbose_name='Cód. País')),
                ('dest_country', models.CharField(default='Brasil', max_length=60, verbose_name='País')),
                ('total_products', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='Produtos')),
                ('total_discount', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='Desconto')),
                ('total_freight', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='Frete')),
                ('total_insurance', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='Seguro')),
                ('total_other', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='Outras Desp.')),
                ('total_bc_icms', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='BC ICMS')),
                ('total_icms', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='ICMS')),
                ('total_bc_st', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='BC ST')),
                ('total_icms_st', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='ICMS ST')),
                ('total_ipi', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='IPI')),
                ('total_pis', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='PIS')),
                ('total_cofins', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='COFINS')),
                ('total_nf', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='Total NF')),
                ('additional_info', models.TextField(blank=True, verbose_name='Informações Complementares')),
                ('fiscal_info', models.TextField(blank=True, verbose_name='Informações ao Fisco')),
                ('status', models.CharField(choices=[('RASCUNHO', 'Rascunho'), ('PENDENTE', 'Pendente de Transmissão'), ('AUTORIZADA', 'Autorizada'), ('REJEITADA', 'Rejeitada'), ('CANCELADA', 'Cancelada'), ('INUTILIZADA', 'Inutilizada'), ('DENEGADA', 'Denegada')], db_index=True, default='RASCUNHO', max_length=20, verbose_name='Status')),
                ('protocol', models.CharField(blank=True, max_length=60, verbose_name='Protocolo')),
                ('authorized_at', models.DateTimeField(blank=True, null=True, verbose_name='Data Autorização')),
                ('return_code', models.CharField(blank=True, max_length=10, verbose_name='Código Retorno SEFAZ')),
                ('return_message', models.TextField(blank=True, verbose_name='Mensagem Retorno')),
                ('xml_sent', models.TextField(blank=True, verbose_name='XML Enviado')),
                ('xml_return', models.TextField(blank=True, verbose_name='XML Retorno')),
                ('xml_cancel', models.TextField(blank=True, verbose_name='XML Cancelamento')),
                ('pdf_danfe', models.FileField(blank=True, null=True, upload_to='danfe/', verbose_name='DANFE PDF')),
                ('ref_access_key', models.CharField(blank=True, max_length=44, verbose_name='Chave NF Ref. Externa')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='invoices_created', to=settings.AUTH_USER_MODEL)),
                ('order', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='invoices', to='core.orders', verbose_name='Pedido')),
                ('ref_invoice', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='derived_invoices', to='core.invoice', verbose_name='NF Referenciada')),
            ],
            options={
                'verbose_name': 'Nota Fiscal',
                'verbose_name_plural': 'Notas Fiscais',
                'ordering': ['-issue_date'],
            },
        ),
        migrations.CreateModel(
            name='InvoiceEvent',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('event_type', models.CharField(choices=[('110111', 'Cancelamento'), ('110110', 'Carta de Correção'), ('110112', 'Inutilização')], max_length=6, verbose_name='Tipo')),
                ('sequence', models.PositiveSmallIntegerField(default=1, verbose_name='Sequência')),
                ('event_date', models.DateTimeField(default=django.utils.timezone.now, verbose_name='Data')),
                ('justification', models.TextField(verbose_name='Justificativa / Texto')),
                ('event_protocol', models.CharField(blank=True, max_length=60, verbose_name='Protocolo')),
                ('return_code', models.CharField(blank=True, max_length=10, verbose_name='Código Retorno')),
                ('return_message', models.TextField(blank=True, verbose_name='Mensagem Retorno')),
                ('xml_event', models.TextField(blank=True, verbose_name='XML Evento')),
                ('xml_return', models.TextField(blank=True, verbose_name='XML Retorno')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('invoice', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='events', to='core.invoice')),
            ],
            options={
                'verbose_name': 'Evento de NF',
                'verbose_name_plural': 'Eventos de NF',
                'ordering': ['-event_date'],
            },
        ),
        migrations.CreateModel(
            name='InvoiceItem',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('item_number', models.PositiveSmallIntegerField(verbose_name='Nº Item')),
                ('product_code', models.CharField(max_length=60, verbose_name='Código')),
                ('ean', models.CharField(blank=True, default='SEM GTIN', max_length=14, verbose_name='EAN/GTIN')),
                ('description', models.CharField(max_length=120, verbose_name='Descrição')),
                ('ncm', models.CharField(max_length=8, verbose_name='NCM')),
                ('cest', models.CharField(blank=True, max_length=7, verbose_name='CEST')),
                ('cfop', models.CharField(max_length=4, verbose_name='CFOP')),
                ('unit', models.CharField(default='UN', max_length=6, verbose_name='Unidade')),
                ('origin', models.CharField(default='0', max_length=1, verbose_name='Origem')),
                ('quantity', models.DecimalField(decimal_places=4, max_digits=15, verbose_name='Quantidade')),
                ('unit_price', models.DecimalField(decimal_places=10, max_digits=15, verbose_name='Preço Unitário')),
                ('gross_total', models.DecimalField(decimal_places=2, max_digits=15, verbose_name='Total Bruto')),
                ('discount', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='Desconto')),
                ('addition', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='Acréscimo')),
                ('freight', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='Frete Item')),
                ('insurance', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='Seguro Item')),
                ('other', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='Outras Desp.')),
                ('icms_cst', models.CharField(blank=True, max_length=3, verbose_name='CST ICMS')),
                ('icms_csosn', models.CharField(blank=True, max_length=3, verbose_name='CSOSN')),
                ('icms_bc', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='BC ICMS')),
                ('icms_rate', models.DecimalField(decimal_places=4, default=0, max_digits=7, verbose_name='Alíq. ICMS %')),
                ('icms_value', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='Valor ICMS')),
                ('icms_st_bc', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='BC ST')),
                ('icms_st_rate', models.DecimalField(decimal_places=4, default=0, max_digits=7, verbose_name='Alíq. ST %')),
                ('icms_st_value', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='Valor ST')),
                ('sn_credit_rate', models.DecimalField(decimal_places=4, default=0, max_digits=7, verbose_name='% Crédito SN')),
                ('sn_credit_value', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='Valor Crédito SN')),
                ('pis_cst', models.CharField(blank=True, max_length=2, verbose_name='CST PIS')),
                ('pis_bc', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='BC PIS')),
                ('pis_rate', models.DecimalField(decimal_places=4, default=0, max_digits=7, verbose_name='Alíq. PIS %')),
                ('pis_value', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='Valor PIS')),
                ('cofins_cst', models.CharField(blank=True, max_length=2, verbose_name='CST COFINS')),
                ('cofins_bc', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='BC COFINS')),
                ('cofins_rate', models.DecimalField(decimal_places=4, default=0, max_digits=7, verbose_name='Alíq. COFINS %')),
                ('cofins_value', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='Valor COFINS')),
                ('item_info', models.CharField(blank=True, max_length=500, verbose_name='Info Adicional Item')),
                ('invoice', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='items', to='core.invoice')),
                ('order_item', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='invoice_items', to='core.orderitem')),
            ],
            options={
                'verbose_name': 'Item da NF',
                'verbose_name_plural': 'Itens da NF',
                'ordering': ['item_number'],
            },
        ),
        migrations.CreateModel(
            name='InvoiceLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('action', models.CharField(choices=[('GENERATE', 'Geração'), ('SIGN', 'Assinatura XML'), ('TRANSMIT', 'Transmissão SEFAZ'), ('QUERY', 'Consulta Status'), ('CANCEL', 'Cancelamento'), ('VOID', 'Inutilização'), ('CORRECTION', 'Carta de Correção'), ('DANFE', 'Geração DANFE')], max_length=20, verbose_name='Ação')),
                ('result', models.CharField(choices=[('SUCCESS', 'Sucesso'), ('ERROR', 'Erro'), ('WARNING', 'Aviso')], max_length=10, verbose_name='Resultado')),
                ('return_code', models.CharField(blank=True, max_length=10, verbose_name='Código')),
                ('message', models.TextField(verbose_name='Mensagem')),
                ('detail', models.TextField(blank=True, verbose_name='Detalhe / Stacktrace')),
                ('xml_sent', models.TextField(blank=True, verbose_name='XML Enviado (snapshot)')),
                ('xml_return', models.TextField(blank=True, verbose_name='XML Retorno (snapshot)')),
                ('duration_ms', models.PositiveIntegerField(blank=True, null=True, verbose_name='Duração (ms)')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('invoice', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='logs', to='core.invoice')),
            ],
            options={
                'verbose_name': 'Log de NF',
                'verbose_name_plural': 'Logs de NF',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='InvoicePayment',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('payment_code', models.CharField(choices=[('01', 'Dinheiro'), ('02', 'Cheque'), ('03', 'Cartão Crédito'), ('04', 'Cartão Débito'), ('05', 'Crédito Loja'), ('10', 'Vale Alimentação'), ('11', 'Vale Refeição'), ('12', 'Vale Presente'), ('13', 'Vale Combustível'), ('14', 'Duplicata'), ('15', 'Boleto'), ('16', 'Depósito'), ('17', 'PIX'), ('90', 'Sem Pagamento'), ('99', 'Outros')], max_length=2, verbose_name='Forma (SEFAZ)')),
                ('value', models.DecimalField(decimal_places=2, max_digits=15, verbose_name='Valor')),
                ('change', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='Troco')),
                ('card_integration', models.CharField(blank=True, choices=[('1', 'Integrado TEF'), ('2', 'Não Integrado')], max_length=1, verbose_name='Tipo Integração')),
                ('card_cnpj', models.CharField(blank=True, max_length=14, verbose_name='CNPJ Credenciadora')),
                ('card_flag', models.CharField(blank=True, choices=[('01', 'Visa'), ('02', 'Mastercard'), ('03', 'Amex'), ('04', 'Sorocred'), ('05', 'Diners'), ('06', 'Elo'), ('07', 'Hipercard'), ('08', 'Aura'), ('09', 'Cabal'), ('99', 'Outros')], max_length=2, verbose_name='Bandeira')),
                ('card_auth', models.CharField(blank=True, max_length=20, verbose_name='NSU/Autorização')),
                ('invoice', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='payments', to='core.invoice')),
                ('order_payment', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='invoice_payments', to='core.orderpayment')),
            ],
            options={
                'verbose_name': 'Pagamento da NF',
                'verbose_name_plural': 'Pagamentos da NF',
            },
        ),
        migrations.CreateModel(
            name='InvoiceTransport',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('freight_mode', models.CharField(choices=[('0', 'Remetente (CIF)'), ('1', 'Destinatário (FOB)'), ('2', 'Terceiros'), ('3', 'Próprio – Emitente'), ('4', 'Próprio – Destinatário'), ('9', 'Sem Frete')], default='9', max_length=1, verbose_name='Modalidade Frete')),
                ('carrier_name', models.CharField(blank=True, max_length=60, verbose_name='Nome')),
                ('carrier_cnpj', models.CharField(blank=True, max_length=14, verbose_name='CNPJ')),
                ('carrier_cpf', models.CharField(blank=True, max_length=11, verbose_name='CPF')),
                ('carrier_ie', models.CharField(blank=True, max_length=20, verbose_name='IE')),
                ('carrier_address', models.CharField(blank=True, max_length=60, verbose_name='Endereço')),
                ('carrier_city', models.CharField(blank=True, max_length=60, verbose_name='Cidade')),
                ('carrier_state', models.CharField(blank=True, max_length=2, verbose_name='UF')),
                ('vehicle_plate', models.CharField(blank=True, max_length=8, verbose_name='Placa')),
                ('vehicle_state', models.CharField(blank=True, max_length=2, verbose_name='UF Placa')),
                ('vehicle_rntc', models.CharField(blank=True, max_length=20, verbose_name='RNTC')),
                ('volume_qty', models.DecimalField(blank=True, decimal_places=4, max_digits=15, null=True, verbose_name='Qtde Volumes')),
                ('volume_species', models.CharField(blank=True, max_length=60, verbose_name='Espécie')),
                ('volume_brand', models.CharField(blank=True, max_length=60, verbose_name='Marca')),
                ('volume_numbering', models.CharField(blank=True, max_length=60, verbose_name='Numeração')),
                ('net_weight', models.DecimalField(blank=True, decimal_places=3, max_digits=15, null=True, verbose_name='Peso Líquido (kg)')),
                ('gross_weight', models.DecimalField(blank=True, decimal_places=3, max_digits=15, null=True, verbose_name='Peso Bruto (kg)')),
                ('seals', models.JSONField(blank=True, default=list, verbose_name='Lacres')),
                ('invoice', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='transport', to='core.invoice')),
            ],
            options={
                'verbose_name': 'Transporte da NF',
                'verbose_name_plural': 'Transportes das NFs',
            },
        ),
        migrations.AddIndex(
            model_name='invoice',
            index=models.Index(fields=['status', 'model'], name='core_invoic_status_356dea_idx'),
        ),
        migrations.AddIndex(
            model_name='invoice',
            index=models.Index(fields=['access_key'], name='core_invoic_access__314d5f_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='invoice',
            unique_together={('order', 'model')},
        ),
        migrations.AlterUniqueTogether(
            name='invoiceitem',
            unique_together={('invoice', 'item_number')},
        ),
    ]
