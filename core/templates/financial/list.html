{% extends 'base/base.html' %}
{% load static %}

{% block title %}Financeiro{% endblock %}

{% block content %}

<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
.card-dashboard {
    border: none;
    border-radius: 14px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.05);
}
.table thead th {
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: .5px;
    background-color: #f8f9fa;
}
.btn-icon {
    width: 36px;
    height: 36px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 1px solid #dee2e6;
    background: #fff;
    transition: .2s;
    cursor: pointer;
}
.btn-icon:hover { transform: scale(1.05); }
.btn-edit:hover  { background: #0d6efd; color: #fff; border-color: #0d6efd; }
.btn-pay:hover   { background: #198754; color: #fff; border-color: #198754; }
.badge-payment {
    font-size: 11px;
    padding: 5px 8px;
    border-radius: 6px;
    background: #eef2f7;
    color: #495057;
}

.btn-estornar:hover {
    background: #dc3545;
    color: #fff !important;
    border-color: #dc3545;
}

.row-overdue {
    background-color: #fff5f5 !important;
    border-left: 4px solid #dc3545;
}
th.actions-col, td.actions-col { width: 110px; text-align: center; }
</style>

<div class="container mt-4">

<!-- HEADER -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <h4 class="fw-bold">Financeiro</h4>
    <a href="{% url 'financial_create' %}" class="btn btn-primary">
        <i class="bi bi-plus-lg"></i>
    </a>
</div>

<!-- FILTROS -->
<div class="card card-dashboard mb-4">
    <div class="card-body">
        <form method="get" class="row g-3">
            <div class="col-md-3">
                <label class="form-label">Cliente</label>
                <select name="client" class="form-select">
                    <option value="">Todos</option>
                    {% for client in clients %}
                        <option value="{{ client.id }}"
                            {% if client_id == client.id|stringformat:"s" %}selected{% endif %}>
                            {{ client.name }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label">Data Inicial</label>
                <input type="date" name="start_date" value="{{ start_date }}" class="form-control">
            </div>
            <div class="col-md-2">
                <label class="form-label">Data Final</label>
                <input type="date" name="end_date" value="{{ end_date }}" class="form-control">
            </div>
            <div class="col-md-2">
                <label class="form-label">Status</label>
                <select name="status" class="form-select">
                    <option value="">Todos</option>
                    <option value="paid" {% if status == 'paid' %}selected{% endif %}>Pago</option>
                    <option value="open" {% if status == 'open' %}selected{% endif %}>Aberto</option>
                </select>
            </div>
            <div class="col-md-3 d-flex align-items-end">
                <button type="submit" class="btn btn-primary me-2">
                    <i class="bi bi-search"></i>
                </button>
                <a href="{% url 'financial_list' %}" class="btn btn-outline-secondary">
                    <i class="bi bi-arrow-clockwise"></i>
                </a>
            </div>
        </form>
    </div>
</div>

<!-- GR√ÅFICO -->
<div class="card card-dashboard mb-4">
    <div class="card-body" style="height:120px;">
        <canvas id="financeChart"></canvas>
    </div>
</div>

<!-- ABAS -->
<ul class="nav nav-tabs mb-3">
    <li class="nav-item">
        <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#entradas">Entradas</button>
    </li>
    <li class="nav-item">
        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#saidas">Sa√≠das</button>
    </li>
</ul>

<div class="tab-content">

<!-- ‚îÄ‚îÄ ENTRADAS ‚îÄ‚îÄ -->
<div class="tab-pane fade show active" id="entradas">
<div class="card card-dashboard">
<div class="table-responsive">
<table class="table align-middle mb-0">
<thead>
<tr>
    <th>ID</th>
    <th>Cliente</th>
    <th>Vencimento</th>
    <th>Parcela</th>
    <th>Descri√ß√£o</th>
    <th>Forma Pgto</th>
    <th>Valor</th>
    <th>Status</th>
    <th class="actions-col">A√ß√µes</th>
</tr>
</thead>
<tbody>
{% for parcel in entradas %}
<tr class="{% if not parcel.payed and parcel.deadline < today %}row-overdue{% endif %}">
    <td>{{ parcel.movement.id }}</td>
    <td>{{ parcel.movement.client.name|default:"‚Äî" }}</td>
    <td>{{ parcel.deadline|date:"d/m/Y" }}</td>
    <td>{{ parcel.parcel }}</td>
    <td>{{ parcel.movement.description }}</td>
    <td>
        {% if parcel.movement.payment_method %}
            <span class="badge-payment">{{ parcel.movement.payment_method }}</span>
        {% else %}
            <span class="text-muted small">‚Äî</span>
        {% endif %}
    </td>
    <td class="fw-bold text-success">R$ {{ parcel.value|floatformat:2 }}</td>
    <td>
        {% if parcel.payed %}
            <span class="badge bg-success">Pago</span>
        {% else %}
            <span class="badge bg-warning text-dark">Aberto</span>
        {% endif %}
    </td>
    <td class="actions-col">
        <div class="d-flex justify-content-center gap-2">

            <a href="{% url 'financial_update' parcel.movement.id %}"
               class="btn-icon btn-edit" title="Editar">
                <i class="bi bi-pencil"></i>
            </a>

            {% if not parcel.payed %}
            {# ‚îÄ‚îÄ Baixar ‚îÄ‚îÄ #}
            <button type="button"
                    class="btn-icon btn-pay btn-pagar"
                    data-pk="{{ parcel.pk }}"
                    data-descricao="{{ parcel.movement.description }}"
                    data-parcela="{{ parcel.parcel }}"
                    data-valor="{{ parcel.value|floatformat:2 }}"
                    data-vencimento="{{ parcel.deadline|date:'d/m/Y' }}"
                    data-payment-method-id="{{ parcel.movement.payment_method.pk|default:'' }}"
                    title="Registrar pagamento">
                <i class="bi bi-cash-stack"></i>
            </button>
            {% else %}
            {# ‚îÄ‚îÄ Estornar ‚îÄ‚îÄ #}
            <button type="button"
                    class="btn-icon btn-estornar"
                    data-pk="{{ parcel.pk }}"
                    data-descricao="{{ parcel.movement.description }}"
                    data-parcela="{{ parcel.parcel }}"
                    data-valor="{{ parcel.value|floatformat:2 }}"
                    data-paydate="{{ parcel.paydate|date:'d/m/Y' }}"
                    title="Estornar pagamento"
                    style="border-color:#dc3545; color:#dc3545;">
                <i class="bi bi-arrow-counterclockwise"></i>
            </button>
            {% endif %}

        </div>
    </td>
</tr>
{% empty %}
<tr><td colspan="9" class="text-center text-muted py-4">Nenhuma entrada encontrada.</td></tr>
{% endfor %}
</tbody>
</table>
</div>
</div>
</div>

<!-- ‚îÄ‚îÄ SA√çDAS ‚îÄ‚îÄ -->
<div class="tab-pane fade" id="saidas">
<div class="card card-dashboard">
<div class="table-responsive">
<table class="table align-middle mb-0">
<thead>
<tr>
    <th>ID</th>
    <th>Descri√ß√£o</th>
    <th>Fornecedor</th>
    <th>Vencimento</th>
    <th>Parcela</th>
    <th>Forma Pgto</th>
    <th>Valor</th>
    <th>Status</th>
    <th class="actions-col">A√ß√µes</th>
</tr>
</thead>
<tbody>
{% for parcel in saidas %}
<tr class="{% if not parcel.payed and parcel.deadline < today %}row-overdue{% endif %}">
    <td>{{ parcel.movement.id }}</td>
    <td>{{ parcel.movement.description }}</td>
    <td>{{ parcel.movement.client.name|default:"‚Äî" }}</td>
    <td>{{ parcel.deadline|date:"d/m/Y" }}</td>
    <td>{{ parcel.parcel }}</td>
    <td>
        {% if parcel.movement.payment_method %}
            <span class="badge-payment">{{ parcel.movement.payment_method }}</span>
        {% else %}
            <span class="text-muted small">‚Äî</span>
        {% endif %}
    </td>
    <td class="fw-bold text-danger">R$ {{ parcel.value|floatformat:2 }}</td>
    <td>
        {% if parcel.payed %}
            <span class="badge bg-success">Pago</span>
        {% else %}
            <span class="badge bg-warning text-dark">Aberto</span>
        {% endif %}
    </td>
    <td class="actions-col">
        <div class="d-flex justify-content-center gap-2">

            <a href="{% url 'financial_update' parcel.movement.id %}"
               class="btn-icon btn-edit" title="Editar">
                <i class="bi bi-pencil"></i>
            </a>

            {% if not parcel.payed %}
            {# ‚îÄ‚îÄ Baixar ‚îÄ‚îÄ #}
            <button type="button"
                    class="btn-icon btn-pay btn-pagar"
                    data-pk="{{ parcel.pk }}"
                    data-descricao="{{ parcel.movement.description }}"
                    data-parcela="{{ parcel.parcel }}"
                    data-valor="{{ parcel.value|floatformat:2 }}"
                    data-vencimento="{{ parcel.deadline|date:'d/m/Y' }}"
                    data-payment-method-id="{{ parcel.movement.payment_method.pk|default:'' }}"
                    title="Registrar pagamento">
                <i class="bi bi-cash-stack"></i>
            </button>
            {% else %}
            {# ‚îÄ‚îÄ Estornar ‚îÄ‚îÄ #}
            <button type="button"
                    class="btn-icon btn-estornar"
                    data-pk="{{ parcel.pk }}"
                    data-descricao="{{ parcel.movement.description }}"
                    data-parcela="{{ parcel.parcel }}"
                    data-valor="{{ parcel.value|floatformat:2 }}"
                    data-paydate="{{ parcel.paydate|date:'d/m/Y' }}"
                    title="Estornar pagamento"
                    style="border-color:#dc3545; color:#dc3545;">
                <i class="bi bi-arrow-counterclockwise"></i>
            </button>
            {% endif %}

        </div>
    </td>
</tr>
{% empty %}
<tr><td colspan="9" class="text-center text-muted py-4">Nenhuma sa√≠da encontrada.</td></tr>
{% endfor %}
</tbody>
</table>
</div>
</div>
</div>

</div>{# /tab-content #}


<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     MODAL ‚Äî CONFIRMAR PAGAMENTO
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="modal fade" id="modalPagamento" tabindex="-1" aria-labelledby="modalPagamentoLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow">

            <div class="modal-header border-0 pb-0">
                <h5 class="modal-title fw-bold" id="modalPagamentoLabel">üí∞ Confirmar Pagamento</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body pt-3">

                <!-- Resumo da parcela -->
                <div class="rounded-3 p-3 mb-4" style="background:#f8f9fa;">
                    <div class="row g-2 small">
                        <div class="col-8">
                            <span class="text-muted">Descri√ß√£o</span><br>
                            <strong id="pay-descricao">‚Äî</strong>
                        </div>
                        <div class="col-4">
                            <span class="text-muted">Parcela</span><br>
                            <strong id="pay-parcela">‚Äî</strong>
                        </div>
                        <div class="col-6">
                            <span class="text-muted">Valor</span><br>
                            <strong class="text-success fs-5" id="pay-valor">‚Äî</strong>
                        </div>
                        <div class="col-6">
                            <span class="text-muted">Vencimento</span><br>
                            <strong id="pay-vencimento">‚Äî</strong>
                        </div>
                    </div>
                </div>

                <!-- Formul√°rio -->
                <form id="form-pagamento">
                    {% csrf_token %}

                    <div class="mb-3">
                        <label class="form-label fw-semibold">Data do pagamento</label>
                        <input type="date" name="paydate" id="pay-paydate" class="form-control" required>
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-semibold">
                            Forma de pagamento <span class="text-muted fw-normal">(opcional)</span>
                        </label>
                        <select name="payment_method" id="pay-payment-method" class="form-select">
                            <option value="">‚Äî Manter atual ‚Äî</option>
                            {% for pm in payment_methods %}
                            <option value="{{ pm.pk }}">{{ pm }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="mb-1">
                        <label class="form-label fw-semibold">
                            Banco <span class="text-muted fw-normal">(opcional)</span>
                        </label>
                        <select name="bank" id="pay-bank" class="form-select">
                            <option value="">‚Äî Selecione o banco ‚Äî</option>
                            {% for bank in banks %}
                            <option value="{{ bank.pk }}">
                                {{ bank.name }} ‚Äî {{ bank.bank_name }} ({{ bank.account_number }})
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                </form>

                <!-- Feedback de erro -->
                <div id="pay-erro" class="alert alert-danger mt-3 d-none small"></div>

            </div>

            <div class="modal-footer border-0 pt-0">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-success fw-semibold px-4" id="btn-confirmar-pagar">
                    <span id="btn-pay-texto">‚úÖ Confirmar Pagamento</span>
                    <span id="btn-pay-loading" class="d-none">
                        <span class="spinner-border spinner-border-sm me-1"></span> Salvando...
                    </span>
                </button>
            </div>

        </div>
    </div>
</div>

<div class="modal fade" id="modalEstorno" tabindex="-1" aria-labelledby="modalEstornoLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow">

            <div class="modal-header border-0 pb-0">
                <h5 class="modal-title fw-bold text-danger" id="modalEstornoLabel">
                    ‚Ü©Ô∏è Estornar Pagamento
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body pt-3">

                <div class="rounded-3 p-3 mb-3" style="background:#fff5f5; border:1px solid #f5c2c7;">
                    <div class="row g-2 small">
                        <div class="col-8">
                            <span class="text-muted">Descri√ß√£o</span><br>
                            <strong id="estorno-descricao">‚Äî</strong>
                        </div>
                        <div class="col-4">
                            <span class="text-muted">Parcela</span><br>
                            <strong id="estorno-parcela">‚Äî</strong>
                        </div>
                        <div class="col-6">
                            <span class="text-muted">Valor</span><br>
                            <strong class="text-danger fs-5" id="estorno-valor">‚Äî</strong>
                        </div>
                        <div class="col-6">
                            <span class="text-muted">Pago em</span><br>
                            <strong id="estorno-paydate">‚Äî</strong>
                        </div>
                    </div>
                </div>

                <p class="text-muted small mb-0">
                    ‚ö†Ô∏è O pagamento ser√° revertido e a parcela voltar√° ao status <strong>Aberto</strong>.
                    O saldo do banco ser√° ajustado automaticamente.
                </p>

                <div id="estorno-erro" class="alert alert-danger mt-3 d-none small"></div>

            </div>

            <div class="modal-footer border-0 pt-0">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-danger fw-semibold px-4" id="btn-confirmar-estorno">
                    <span id="btn-estorno-texto">‚Ü©Ô∏è Confirmar Estorno</span>
                    <span id="btn-estorno-loading" class="d-none">
                        <span class="spinner-border spinner-border-sm me-1"></span> Processando...
                    </span>
                </button>
            </div>

        </div>
    </div>
</div>

</div>{# /container #}

<script>
new Chart(document.getElementById('financeChart'), {
    type: 'bar',
    data: {
        labels: ['Entradas', 'Sa√≠das'],
        datasets: [{
            data: [{{ total_entradas }}, {{ total_saidas }}],
            backgroundColor: ['#198754','#dc3545'],
            borderRadius: 8,
            barThickness: 25
        }]
    },
    options: {
        indexAxis: 'y',
        plugins: { legend: { display: false } },
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            x: { grid: { display: false } },
            y: { grid: { display: false } }
        }
    }
});

/* ‚îÄ‚îÄ Modal de pagamento ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
(function () {
    let parcelPk = null;

    // Monta a URL base a partir da URL com pk=0, substituindo apenas o segmento num√©rico
    const PAY_URL_TEMPLATE = "{% url 'parcel_pay' 0 %}";  // ex: /financeiro/parcela/0/pagar/
    function payUrl(pk) {
        return PAY_URL_TEMPLATE.replace('/0/', '/' + pk + '/');
    }

    document.addEventListener('click', function (e) {
        const btn = e.target.closest('.btn-pagar');
        if (!btn) return;

        parcelPk = btn.dataset.pk;

        document.getElementById('pay-descricao').textContent  = btn.dataset.descricao  || '‚Äî';
        document.getElementById('pay-parcela').textContent    = btn.dataset.parcela     || '‚Äî';
        document.getElementById('pay-valor').textContent      = 'R$ ' + (btn.dataset.valor || '0,00');
        document.getElementById('pay-vencimento').textContent = btn.dataset.vencimento  || '‚Äî';

        // Pr√©-seleciona a forma de pagamento atual
        const pmId = btn.dataset.paymentMethodId || '';
        const pmSelect = document.getElementById('pay-payment-method');
        pmSelect.value = pmId;  // se n√£o existir na lista, fica em "Manter atual"

        document.getElementById('pay-paydate').value = new Date().toISOString().slice(0, 10);
        document.getElementById('pay-bank').value    = '';
        document.getElementById('pay-erro').classList.add('d-none');

        new bootstrap.Modal(document.getElementById('modalPagamento')).show();
    });

    document.getElementById('btn-confirmar-pagar').addEventListener('click', function () {
        if (!parcelPk) return;

        const btn           = this;
        const texto         = document.getElementById('btn-pay-texto');
        const loading       = document.getElementById('btn-pay-loading');
        const erroDiv       = document.getElementById('pay-erro');
        const paydate       = document.getElementById('pay-paydate').value;
        const bank          = document.getElementById('pay-bank').value;
        const paymentMethod = document.getElementById('pay-payment-method').value;
        const csrf          = document.querySelector('#form-pagamento [name=csrfmiddlewaretoken]').value;

        if (!paydate) {
            erroDiv.textContent = 'Informe a data do pagamento.';
            erroDiv.classList.remove('d-none');
            return;
        }

        btn.disabled = true;
        texto.classList.add('d-none');
        loading.classList.remove('d-none');
        erroDiv.classList.add('d-none');

        const body = new URLSearchParams({ paydate, csrfmiddlewaretoken: csrf });
        if (bank)          body.append('bank', bank);
        if (paymentMethod) body.append('payment_method', paymentMethod);

        fetch(payUrl(parcelPk), {
            method: 'POST',
            body:   body,
        })
        .then(r => r.json())
        .then(function (data) {
            if (data.ok) {
                bootstrap.Modal.getInstance(document.getElementById('modalPagamento')).hide();
                window.location.reload();
            } else {
                erroDiv.textContent = data.error || 'Erro ao registrar pagamento.';
                erroDiv.classList.remove('d-none');
                btn.disabled = false;
                texto.classList.remove('d-none');
                loading.classList.add('d-none');
            }
        })
        .catch(function () {
            erroDiv.textContent = 'Erro de conex√£o. Tente novamente.';
            erroDiv.classList.remove('d-none');
            btn.disabled = false;
            texto.classList.remove('d-none');
            loading.classList.add('d-none');
        });
    });
})();

(function () {
    let estornoPk = null;
    const UNPAY_URL_TEMPLATE = "{% url 'parcel_unpay' 0 %}";
    function unpayUrl(pk) {
        return UNPAY_URL_TEMPLATE.replace('/0/', '/' + pk + '/');
    }

    // Abre o modal de estorno
    document.addEventListener('click', function (e) {
        const btn = e.target.closest('.btn-estornar');
        if (!btn) return;

        estornoPk = btn.dataset.pk;

        document.getElementById('estorno-descricao').textContent = btn.dataset.descricao || '‚Äî';
        document.getElementById('estorno-parcela').textContent   = btn.dataset.parcela   || '‚Äî';
        document.getElementById('estorno-valor').textContent     = 'R$ ' + (btn.dataset.valor || '0,00');
        document.getElementById('estorno-paydate').textContent   = btn.dataset.paydate   || '‚Äî';
        document.getElementById('estorno-erro').classList.add('d-none');

        new bootstrap.Modal(document.getElementById('modalEstorno')).show();
    });

    // Confirma o estorno
    document.getElementById('btn-confirmar-estorno').addEventListener('click', function () {
        if (!estornoPk) return;

        const btn     = this;
        const texto   = document.getElementById('btn-estorno-texto');
        const loading = document.getElementById('btn-estorno-loading');
        const erroDiv = document.getElementById('estorno-erro');
        const csrf    = document.querySelector('[name=csrfmiddlewaretoken]').value;

        btn.disabled = true;
        texto.classList.add('d-none');
        loading.classList.remove('d-none');
        erroDiv.classList.add('d-none');

        fetch(unpayUrl(estornoPk), {
            method:  'POST',
            headers: { 'X-CSRFToken': csrf },
            body:    new URLSearchParams({ csrfmiddlewaretoken: csrf }),
        })
        .then(r => r.json())
        .then(function (data) {
            if (data.ok) {
                bootstrap.Modal.getInstance(document.getElementById('modalEstorno')).hide();
                window.location.reload();
            } else {
                erroDiv.textContent = data.error || 'Erro ao estornar.';
                erroDiv.classList.remove('d-none');
                btn.disabled = false;
                texto.classList.remove('d-none');
                loading.classList.add('d-none');
            }
        })
        .catch(function () {
            erroDiv.textContent = 'Erro de conex√£o. Tente novamente.';
            erroDiv.classList.remove('d-none');
            btn.disabled = false;
            texto.classList.remove('d-none');
            loading.classList.add('d-none');
        });
    });
})();

</script>

{% endblock %}