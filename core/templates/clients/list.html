{% extends 'base/base.html' %}
{% load static %}
{% block title %}Clientes{% endblock %}

{% block content %}

<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

<style>
.card-dashboard{
    border:none;
    border-radius:14px;
    box-shadow:0 4px 20px rgba(0,0,0,0.05);
}

.table thead th{
    font-size:12px;
    text-transform:uppercase;
    letter-spacing:.5px;
    background:#f8f9fa;
}

.btn-icon{
    width:34px;
    height:34px;
    border-radius:8px;
    display:flex;
    align-items:center;
    justify-content:center;
    border:1px solid #dee2e6;
    background:#fff;
    transition:.2s;
}

.btn-icon:hover{
    transform:scale(1.05);
}

.btn-primary-icon{
    background:#0d6efd;
    color:#fff;
    border:none;
}

.btn-danger-icon{
    background:#dc3545;
    color:#fff;
    border:none;
}
</style>

<div class="container mt-4">

<!-- HEADER -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <h4 class="fw-bold mb-0">Clientes</h4>

    <a href="{% url 'client_create' %}"
       class="btn-icon btn-primary-icon">
        <i class="bi bi-plus-lg"></i>
    </a>
</div>

<!-- DASHBOARD -->
<div class="row mb-4 g-3">

<div class="col-md-4">
    <div class="card card-dashboard border-start border-4 border-primary">
        <div class="card-body py-2">
            <small class="text-muted">Total de Clientes</small>
            <h5 class="fw-bold mb-0">{{ total_clients }}</h5>
        </div>
    </div>
</div>

<div class="col-md-4">
    <div class="card card-dashboard border-start border-4 border-success">
        <div class="card-body py-2">
            <small class="text-muted">Clientes com Email</small>
            <h5 class="fw-bold mb-0">{{ clients_with_email }}</h5>
        </div>
    </div>
</div>

<div class="col-md-4">
    <div class="card card-dashboard border-start border-4 border-info">
        <div class="card-body py-2">
            <small class="text-muted">Clientes com Telefone</small>
            <h5 class="fw-bold mb-0">{{ clients_with_phone }}</h5>
        </div>
    </div>
</div>

</div>

<!-- BUSCA -->
<div class="card card-dashboard mb-4">
    <div class="card-body">
        <form method="get" class="row g-3 align-items-end">

            <div class="col-md-6">
                <label class="form-label">Buscar cliente</label>
                <input type="text"
                       name="q"
                       value="{{ search }}"
                       class="form-control"
                       placeholder="Nome, email ou documento">
            </div>

            <div class="col-md-3 d-flex gap-2">
                <button class="btn-icon btn-primary-icon">
                    <i class="bi bi-search"></i>
                </button>

                <a href="{% url 'client_list' %}"
                   class="btn-icon">
                    <i class="bi bi-arrow-clockwise"></i>
                </a>
            </div>

        </form>
    </div>
</div>

<!-- TABELA -->
<div class="card card-dashboard">
<div class="table-responsive">
<table class="table align-middle mb-0">

<thead>
<tr>
    <th>Cliente</th>
    <th class="d-none d-md-table-cell">Email</th>
    <th class="d-none d-md-table-cell">Telefone</th>
    <th class="d-none d-md-table-cell">Documento</th>
    <th class="text-center" width="110">Ações</th>
</tr>
</thead>

<tbody>

{% for client in clients %}
<tr>

    <td>
        <strong>{{ client.name }}</strong>

        <!-- MOBILE INFO -->
        <div class="d-md-none small text-muted mt-1">
            {% if client.email %}
                <div><i class="bi bi-envelope"></i> {{ client.email }}</div>
            {% endif %}
            {% if client.phone %}
                <div><i class="bi bi-telephone"></i> {{ client.phone }}</div>
            {% endif %}
            {% if client.document %}
                <div><i class="bi bi-person-vcard"></i> {{ client.document }}</div>
            {% endif %}
        </div>
    </td>

    <td class="d-none d-md-table-cell">
        {{ client.email|default:"—" }}
    </td>

    <td class="d-none d-md-table-cell">
        {{ client.phone|default:"—" }}
    </td>

    <td class="d-none d-md-table-cell">
        {{ client.document|default:"—" }}
    </td>

    <td>
        <div class="d-flex justify-content-center gap-2">

            <a href="{% url 'client_update' client.id %}"
               class="btn-icon">
                <i class="bi bi-pencil"></i>
            </a>

            <a href="{% url 'client_delete' client.id %}"
               class="btn-icon btn-danger-icon"
               onclick="return confirm('Excluir este cliente?')">
                <i class="bi bi-trash"></i>
            </a>

        </div>
    </td>

</tr>

{% empty %}
<tr>
    <td colspan="5"
        class="text-center text-muted py-4">
        Nenhum cliente encontrado
    </td>
</tr>
{% endfor %}

</tbody>
</table>
</div>
</div>

</div>

{% endblock %}
